"use strict";var WPMailSMTPEmailReports=window.WPMailSMTPEmailReports||function(t,i){var l={$canvas:i("#wp-mail-smtp-email-reports-chart"),$timespanSelect:i('.wp-mail-smtp-filter-date select[name="timespan"]'),$dateInput:i('.wp-mail-smtp-filter-date input[name="date"]'),$reportsTitle:i(".wp-mail-smtp-email-reports__title"),$spinner:i(".wp-mail-smtp-email-reports .spinner")},a=wp_mail_smtp_email_reports.no_send_confirmations?[{label:wp_mail_smtp_email_reports.texts.sent_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"sent"},{label:wp_mail_smtp_email_reports.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"failed"}]:[{label:wp_mail_smtp_email_reports.texts.confirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(106, 160, 139, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"confirmed"},{label:wp_mail_smtp_email_reports.texts.unconfirmed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(167, 170, 173, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"unconfirmed"},{label:wp_mail_smtp_email_reports.texts.failed_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(214, 54, 56, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"failed"}];wp_mail_smtp_email_reports.open_email_tracking&&a.push({label:wp_mail_smtp_email_reports.texts.opened_emails,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(220, 127, 60, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"openCount"}),wp_mail_smtp_email_reports.click_link_tracking&&a.push({label:wp_mail_smtp_email_reports.texts.clicked_links,data:[],backgroundColor:"rgba(0, 0, 0, 0)",borderColor:"rgba(251, 170, 111, 1)",borderWidth:2,pointRadius:4,pointBorderWidth:1,pointBackgroundColor:"rgba(255, 255, 255, 1)",key:"clickCount"});var n={instance:null,settings:{type:"line",data:{labels:[],datasets:a.slice()},options:{maintainAspectRatio:!1,scales:{x:{type:"timeseries",time:{tooltipFormat:"MMM D"},ticks:{beginAtZero:!0,source:"labels",padding:0,minRotation:25,maxRotation:25,callback:function(t,e,a){var s=Math.floor(a.length/7);return s<1||(a.length-e-1)%s==0?moment(t).format("MMM D"):void 0}},offset:!1,gridLines:{offsetGridLines:!1}},y:{ticks:{beginAtZero:!0,maxTicksLimit:6,padding:0,callback:function(t){if(Math.floor(t)===t)return t}}}},elements:{line:{tension:0,fill:!0}},animation:!1,plugins:{legend:{display:!1},tooltip:{displayColors:!1}}}},init:function(){var t;l.$canvas.length&&(t=l.$canvas[0].getContext("2d"),n.instance=new WPMailSMTPChart(t,n.settings),n.updateUI(wp_mail_smtp_email_reports.stats_by_date_chart_data))},updateUI:function(t){n.updateChartData(t),n.instance.update()},updateChartData:function(t){n.settings.data.labels=[];var s={confirmed:[],unconfirmed:[],sent:[],failed:[],openCount:[],clickCount:[]};i.each(t,function(t,e){var a=moment(e.day);n.settings.data.labels.push(a),s.confirmed.push({x:a,y:e.delivered}),s.unconfirmed.push({x:a,y:e.sent}),s.sent.push({x:a,y:Number(e.sent)+Number(e.delivered)}),s.failed.push({x:a,y:e.unsent}),s.openCount.push({x:a,y:e.open_count}),s.clickCount.push({x:a,y:e.click_count})}),n.settings.data.datasets=a.slice();for(var e=0;e<n.settings.data.datasets.length;e++)n.settings.data.datasets[e].data=s[n.settings.data.datasets[e].key]}},p={chart:n,init:function(){i(p.ready)},ready:function(){p.events(),n.init(),p.updateTotalsUI(wp_mail_smtp_email_reports.stats_totals),p.initFlatpickr()},events:function(){l.$timespanSelect.on("change",function(){p.showHideDateInput()}).trigger("change"),i(t).on("click",".js-wp-mail-smtp-reset-stats",function(){p.resetStatsUI()}),i(".js-wp-mail-smtp-toggle-single-stats").on("click",p.toggleSingleStats),i(".subject-toggle-single-stats").on("click",p.subjectToggleSingleStats)},showHideDateInput:function(){var t=i(".wp-mail-smtp-filter-date"),e="wp-mail-smtp-filter-date-custom";"custom"===l.$timespanSelect.val()?t.addClass(e):t.removeClass(e)},subjectToggleSingleStats:function(t){t.preventDefault();const e=i(this),a=e.closest("tr");a.hasClass("wp-mail-smtp-active-row")||p.performToggleSingleStats(a,e.data("subject"),a.find(".js-wp-mail-smtp-toggle-single-stats"),!1)},toggleSingleStats:function(){const t=i(this);p.performToggleSingleStats(t.closest("tr"),t.data("subject"),t,t.find(".dashicons").hasClass("dashicons-dismiss"))},performToggleSingleStats:function(t,e,a,s){if(s)p.resetStatsUI();else{p.resetTableState();const i=a.find(".dashicons"),o=l.$timespanSelect.val(),r=l.$dateInput.val();l.$spinner.removeClass("wp-mail-smtp-hide"),t.addClass("wp-mail-smtp-active-row"),a.addClass("dismiss-single-stats"),i.removeClass("dashicons-chart-line").addClass("dashicons-dismiss"),p.loadSingleStats(e,o,r).done(function(t){l.$reportsTitle.html(e+'<i class="dashicons dashicons-dismiss js-wp-mail-smtp-reset-stats"></i>'),p.updateTotalsUI(t.totals),n.updateUI(t.by_date_chart_data),l.$spinner.addClass("wp-mail-smtp-hide")})}},loadSingleStats:function(t,e,a){a={_wpnonce:wp_mail_smtp_email_reports.nonce,action:"wp_mail_smtp_email_reports_get_single_stats",s:t,timespan:e,date:a};return i.post(wp_mail_smtp.ajax_url,a)},resetStatsUI:function(){wp_mail_smtp_email_reports.is_search?l.$reportsTitle.html(wp_mail_smtp_email_reports.texts.search_results):l.$reportsTitle.html(wp_mail_smtp_email_reports.texts.all_emails),p.updateTotalsUI(wp_mail_smtp_email_reports.stats_totals),n.updateUI(wp_mail_smtp_email_reports.stats_by_date_chart_data),p.resetTableState()},resetTableState:function(){const t=i(".wp-list-table");t.find(".wp-mail-smtp-active-row").removeClass("wp-mail-smtp-active-row"),t.find(".dashicons-dismiss").removeClass("dashicons-dismiss").addClass("dashicons-chart-line"),t.find(".dismiss-single-stats").removeClass("dismiss-single-stats")},updateTotalsUI:function(t){var e,a;null!==t&&(a=(e=Number(t.sent)+Number(t.delivered))+Number(t.unsent),i(".wp-mail-smtp-email-reports__stats-item--total span").text(a),i(".wp-mail-smtp-email-reports__stats-item--unsent span").text(t.unsent),wp_mail_smtp_email_reports.no_send_confirmations?i(".wp-mail-smtp-email-reports__stats-item--sent span").text(e):(i(".wp-mail-smtp-email-reports__stats-item--confirmed span").text(t.delivered),i(".wp-mail-smtp-email-reports__stats-item--unconfirmed span").text(t.sent)),wp_mail_smtp_email_reports.open_email_tracking&&i(".wp-mail-smtp-email-reports__stats-item--open-count span").text(t.open_count),wp_mail_smtp_email_reports.click_link_tracking&&i(".wp-mail-smtp-email-reports__stats-item--click-count span").text(t.click_count))},initFlatpickr:function(){var t={rangeSeparator:" - "},e={altInput:!0,altFormat:"M j, Y",dateFormat:"Y-m-d",mode:"range",maxDate:moment().subtract(1,"days").toDate()};"undefined"!==flatpickr&&Object.prototype.hasOwnProperty.call(flatpickr,"l10ns")&&Object.prototype.hasOwnProperty.call(flatpickr.l10ns,wp_mail_smtp.lang_code)&&((t=flatpickr.l10ns[wp_mail_smtp.lang_code]).rangeSeparator=" - "),e.locale=t,i(".wp-mail-smtp-filter-date-selector").flatpickr(e)}};return p}(document,(window,jQuery));WPMailSMTPEmailReports.init();